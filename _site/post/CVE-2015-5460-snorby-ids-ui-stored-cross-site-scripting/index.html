<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>CVE-2015-5460 – Snorby – 2.6.2 - Stored Cross-site Scripting</title>
	<meta name="description" content="">
	<meta name="author" content="Federico Fazzi">
	<link rel="stylesheet" href="/assets/app-9aa3a0497cf8b7ed5697ebed051cfe57.css">
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
	<link rel="canonical" href="http://deftcode.ninja/post/CVE-2015-5460-snorby-ids-ui-stored-cross-site-scripting/">

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-55598198-1', 'auto');
		ga('send', 'pageview');
	</script>
</head>

<body>
	<button id="toggle" class="standard-width" type="button" data-toggle="collapse">
		<span class="toggle-line"></span>
		<span class="toggle-line"></span>
		<span class="toggle-line"></span>
	</button>
	<div class="wrapper">
		<header>
	<h1>DEFTCODE<sup>( 2 )</sup></h1>

	<ul id="navbar">
		<li><a href="http://deftcode.ninja" title="Posts">Posts</a></li>
		<li><a href="http://deftcode.ninja/security" title="Security">Security</a></li>
		<li><a href="http://deftcode.ninja/about" title="About">About</a></li>
	</ul>

	<ul id="social" class="apicos-social-sport">
		
		<li><a href="https://github.com/eurialo" title="Github" target="_blank"><span class="apico apico-github-square"></span></a></li>
		
		
		<li><a href="https://linkedin.com/in/eurialo" title="Linkedin" target="_blank"><span class="apico apico-linkedin-square"></span></a></li>
		
		
		<li><a href="https://twitter.com/federicofazzi" title="Twitter" target="_blank"><span class="apico apico-twitter-square"></span></a></li>
		
		
		<li><a href="https://plus.google.com/+FedericoFazzi" title="Google+" target="_blank"><span class="apico apico-google-plus-square"></span></a></li>
		
		<li><a href="/feed.xml" title="Feed RSS" target="_blank"><span class="apico apico-rss-square"></span></a></li>
	</ul>
	<p>
		<small><a href="https://pgp.mit.edu/pks/lookup?search=0x6D378CAF&op=index&exact=on" title="MIT PGP Public Key Server - 0x6D378CAF" target="_blank">GPG - 2048R/6D378CAF</a></small>
	</p>
</header>
		<section>
		<h1 class="post-title">CVE-2015-5460 – Snorby – 2.6.2 - Stored Cross-site Scripting</h1>
<p class="post-meta">RELEASED IN WEDNESDAY 15, JULY, 2015</p>

<h3 id="vendor">Vendor</h3>

<p><a href="https://www.snorby.org/" title="Snorby">https://www.snorby.org/</a> – <strong>2.6.2</strong></p>

<blockquote>
  <p>Snorby is a new and modern Snort IDS front-end. The basic fundamental concepts behind snorby are simplicity and power. The project goal is to create a free, open source and highly competitive application for network monitoring for both private and enterprise use.</p>
</blockquote>

<h3 id="description">Description</h3>

<p>During my research and testing of new <code>IDS (Intrusion Detection System)</code> like <strong>Suricata</strong> I’ve found a <code>Stored Cross-site Scripting</code> (XSS) vulnerability in <strong>Snorby</strong> that I want to use as web user interface for suricata. The vulnerability exists in the module for adding a new threat classification model where the user input is not correctly sanitized before being saved it on the database or for example the output is not properly filtered, before its rendering in the <strong>event/menu</strong> code, in this way the vector gets executed.</p>

<h3 id="vulnerability">Vulnerability</h3>

<p><strong>CVSS Score</strong>: 4.3 (<a href="https://nvd.nist.gov/cvss.cfm?calculator&amp;version=2&amp;vector=(AV:N/AC:M/Au:N/C:N/I:P/A:N)" title="CVSS v2 Vector (AV:N/AC:M/Au:N/C:N/I:P/A:N)" target="_blank">AV:N/AC:M/Au:N/C:N/I:P/A:N</a>)</p>

<p>The <code>XSS vector</code> is triggered in the <strong>snorby/app/views/events/_menu.html.erb</strong> page by the <strong>event/menu</strong>:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="err">&lt;</span>% @classifications.each do |cls| %&gt;
    <span class="err">&lt;</span>% if cls.locked <span class="err">&amp;&amp;</span> cls.hotkey %&gt;
        <span class="err">&lt;</span>%= drop_down_item &quot;#{cls.name}<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&#39;shortcut&#39;</span><span class="nt">&gt;</span>#{cls.shortcut}<span class="nt">&lt;/span&gt;</span>&quot;, &#39;#&#39;, nil, { :class =&gt; &#39;classification&#39;, :&quot;data-classification-id&quot; =&gt; cls.id.to_i } %&gt;
    <span class="err">&lt;</span>% else %&gt;
        <span class="err">&lt;</span>%= drop_down_item &quot;#{cls.name}&quot;, &#39;#&#39;, nil, { :class =&gt; &#39;classification&#39;, :&quot;data-classification-id&quot; =&gt; cls.id.to_i } %&gt;
    <span class="err">&lt;</span>% end %&gt;
<span class="err">&lt;</span>% end %&gt;</code></pre></div>

<h3 id="mitigation">Mitigation</h3>

<p>A simple <code>XSS mitigation</code> on rails could be the usage of the <strong>sanitize</strong>, for example the code below filters the xss vector by removing the onerror attribute from the image tag:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="err">&lt;</span>% @classifications.each do |cls| %
    <span class="err">&lt;</span>% if cls.locked <span class="err">&amp;&amp;</span> cls.hotkey %&gt;
        <span class="err">&lt;</span>%= drop_down_item &quot;#{sanitize cls.name}<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&#39;shortcut&#39;</span><span class="nt">&gt;</span>#{cls.shortcut}<span class="nt">&lt;/span&gt;</span>&quot;, &#39;#&#39;, nil, { :class =&gt; &#39;classification&#39;, :&quot;data-classification-id&quot; =&gt; cls.id.to_i } %&gt;
    <span class="err">&lt;</span>% else %&gt;
        <span class="err">&lt;</span>%= drop_down_item &quot;#{sanitize cls.name}&quot;, &#39;#&#39;, nil, { :class =&gt; &#39;classification&#39;, :&quot;data-classification-id&quot; =&gt; cls.id.to_i } %&gt;
    <span class="err">&lt;</span>% end %&gt;
<span class="err">&lt;</span>% end %&gt;</code></pre></div>

<h3 id="solution">Solution</h3>

<p><strong>Update</strong> to the <strong>latest</strong> version on <a href="https://github.com/Snorby/snorby" title="GitHub - Snorby" target="_blank">GitHub</a>.</p>

<h3 id="disclosure">Disclosure:</h3>

<ul>
  <li><strong>30-06-2015</strong> – Vendor notification (<a href="https://github.com/Snorby/snorby/issues/377" title="GitHub Issue-377" target="_blank">GitHub Issue-377</a>)</li>
  <li><strong>30-06-2015</strong> – CVE id requested</li>
  <li><strong>01-07-2015</strong> – Vendor acknowledge</li>
  <li><strong>01-07-2015</strong> – Vendor pushed a fix (commit-id: <a href="https://github.com/Snorby/snorby/commit/89d7cbcd3697c8a842f1a61b99e9a78f295798fb" title="GitHub commit-id: 89d7cbcd3697c8a842f1a61b99e9a78f295798fb" target="_blank">89d7cbcd3697c8a842f1a61b99e9a78f295798fb</a>)</li>
  <li><strong>09-07-2015</strong> – CVE id assigned (<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5460" title="CVE-2015-5460" target="_blank">CVE-2015-5460</a>)</li>
  <li><strong>15-07-2015</strong> – Public disclosure</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5460" title="CVE-2015-5460">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5460</a></li>
  <li><a href="http://seclists.org/fulldisclosure/2015/Jul/15" title="FullDisclosure">http://seclists.org/fulldisclosure/2015/Jul/15</a></li>
  <li><a href="https://github.com/Snorby/snorby/issues/377" title="GitHub Issue-377">https://github.com/Snorby/snorby/issues/377</a></li>
</ul>



<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-538ce0c960e04da4" async></script>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_sharing_toolbox"></div>

<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'deftcode'; // required: replace example with your forum shortname

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

		</section>
		<footer>
	<p><small>2017 – <b><a href="http://en.wikipedia.org/wiki/MIT_License" title="Wikipedia.org - MIT License" target="_blank">MIT License</a></b></small></p>
</footer>
<script src="/assets/app-cfd2668a2a4934bd07f418c9af7461f6.js"></script>
	</div>
</body>
</html>
